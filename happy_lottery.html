<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>HAPPY HAIR 抽獎活動</title>
    <style>
      #container6 {
      margin: auto;
        background-size: cover;
        display: table-cell;
        vertical-align: middle;
        
      }
      #child {
      line-height: 3em;
      display: table-cell;
      vertical-align: middle;
      height:100vh;   
      -moz-box-sizing: border-box;    
      }
      .panel-body{
          background: rgba(255, 255, 255, 0.85)!important;
      }
      @charset "UTF-8";
      *, *::before, *::after {
        box-sizing: border-box;
      }
      
      .main-block {
        margin-right: 25vw;
        width: 100vw;
        text-align: center;
      }
      
      @media screen and (max-width: 768px) {
        .main-block {
          margin-right: 0;
          width: calc(100vw - 16px);
        }
      }
      .god {
        margin-bottom: 1rem;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.54);
        border: 1px solid rgba(41, 44, 55, 0.27);
        border-radius: 0.5rem;
      }
      .god span {
        position: relative;
        display: inline-grid;
      }
      .god h1 {
        margin: 0;
        font-size: 3rem;
      }
      .god span {
        display: block;
        display: inline-grid;
        
        max-height: 73px;
        overflow: hidden;
        color: #333844;
      }
      .god .wrap.no1 {
        width:15vw;
      }
      .god .wrap.no2 {
        width:42vw;
      }
      .god .wrap.no3 {
        width:25vw;
      }
      @media screen and (max-width: 768px) {
        .god {
          padding: 2rem 0.5rem;
        }
        .god h1 {
          font-size: 2rem;
        }
        .god span {
          max-height: 36px;
        }
      }
      .god .wrap > span {
        -webkit-animation-iteration-count: infinite;
                animation-iteration-count: infinite;
        -webkit-animation-timing-function: linear;
                animation-timing-function: linear;
      }
      
      @-webkit-keyframes spin-1 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 1);
        }
      }
      
      @keyframes spin-1 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 1);
        }
      }
      .god .wrap > .span-1 {
        -webkit-animation-name: spin-1;
                animation-name: spin-1;
        -webkit-animation-duration: 0.03s;
                animation-duration: 0.03s;
      }
      
      @-webkit-keyframes spin-2 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 2);
        }
      }
      
      @keyframes spin-2 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 2);
        }
      }
      .god .wrap > .span-2 {
        -webkit-animation-name: spin-2;
                animation-name: spin-2;
        -webkit-animation-duration: 0.06s;
                animation-duration: 0.06s;
      }
      
      @-webkit-keyframes spin-3 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 3);
        }
      }
      
      @keyframes spin-3 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 3);
        }
      }
      .god .wrap > .span-3 {
        -webkit-animation-name: spin-3;
                animation-name: spin-3;
        -webkit-animation-duration: 0.09s;
                animation-duration: 0.09s;
      }
      
      @-webkit-keyframes spin-4 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 4);
        }
      }
      
      @keyframes spin-4 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 4);
        }
      }
      .god .wrap > .span-4 {
        -webkit-animation-name: spin-4;
                animation-name: spin-4;
        -webkit-animation-duration: 0.12s;
                animation-duration: 0.12s;
      }
      
      @-webkit-keyframes spin-5 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 5);
        }
      }
      
      @keyframes spin-5 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 5);
        }
      }
      .god .wrap > .span-5 {
        -webkit-animation-name: spin-5;
                animation-name: spin-5;
        -webkit-animation-duration: 0.15s;
                animation-duration: 0.15s;
      }
      
      @-webkit-keyframes spin-6 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 6);
        }
      }
      
      @keyframes spin-6 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 6);
        }
      }
      .god .wrap > .span-6 {
        -webkit-animation-name: spin-6;
                animation-name: spin-6;
        -webkit-animation-duration: 0.18s;
                animation-duration: 0.18s;
      }
      
      @-webkit-keyframes spin-7 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 7);
        }
      }
      
      @keyframes spin-7 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 7);
        }
      }
      .god .wrap > .span-7 {
        -webkit-animation-name: spin-7;
                animation-name: spin-7;
        -webkit-animation-duration: 0.21s;
                animation-duration: 0.21s;
      }
      
      @-webkit-keyframes spin-8 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 8);
        }
      }
      
      @keyframes spin-8 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 8);
        }
      }
      .god .wrap > .span-8 {
        -webkit-animation-name: spin-8;
                animation-name: spin-8;
        -webkit-animation-duration: 0.24s;
                animation-duration: 0.24s;
      }
      
      @-webkit-keyframes spin-9 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 9);
        }
      }
      
      @keyframes spin-9 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 9);
        }
      }
      .god .wrap > .span-9 {
        -webkit-animation-name: spin-9;
                animation-name: spin-9;
        -webkit-animation-duration: 0.27s;
                animation-duration: 0.27s;
      }
      
      @-webkit-keyframes spin-10 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 10);
        }
      }
      
      @keyframes spin-10 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 10);
        }
      }
      .god .wrap > .span-10 {
        -webkit-animation-name: spin-10;
                animation-name: spin-10;
        /* -webkit-animation-duration: 0.3s;
                animation-duration: 0.3s; */
        -webkit-animation-duration: 2s;
                animation-duration: 2s;
      }
      
      .table>:not(caption)>*>* {
          padding: 0rem .5rem!important;
          font-size: xx-large;
      }
      
      .warning-banner-bar {
        display:none!important;
      }
      
      @-webkit-keyframes spin-11 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 11);
        }
      }
      
      @keyframes spin-11 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 11);
        }
      }
      .god .wrap > .span-11 {
        -webkit-animation-name: spin-11;
                animation-name: spin-11;
        -webkit-animation-duration: 0.33s;
                animation-duration: 0.33s;
      }
      
      @-webkit-keyframes spin-12 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 12);
        }
      }
      
      @keyframes spin-12 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 12);
        }
      }
      .god .wrap > .span-12 {
        -webkit-animation-name: spin-12;
                animation-name: spin-12;
        -webkit-animation-duration: 0.36s;
                animation-duration: 0.36s;
      }
      
      @-webkit-keyframes spin-13 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 13);
        }
      }
      
      @keyframes spin-13 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 13);
        }
      }
      .god .wrap > .span-13 {
        -webkit-animation-name: spin-13;
                animation-name: spin-13;
        -webkit-animation-duration: 0.39s;
                animation-duration: 0.39s;
      }
      
      @-webkit-keyframes spin-14 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 14);
        }
      }
      
      @keyframes spin-14 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 14);
        }
      }
      .god .wrap > .span-14 {
        -webkit-animation-name: spin-14;
                animation-name: spin-14;
        -webkit-animation-duration: 0.42s;
                animation-duration: 0.42s;
      }
      
      @-webkit-keyframes spin-15 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 15);
        }
      }
      
      @keyframes spin-15 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 15);
        }
      }
      .god .wrap > .span-15 {
        -webkit-animation-name: spin-15;
                animation-name: spin-15;
        -webkit-animation-duration: 0.45s;
                animation-duration: 0.45s;
      }
      
      @-webkit-keyframes spin-16 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 16);
        }
      }
      
      @keyframes spin-16 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 16);
        }
      }
      .god .wrap > .span-16 {
        -webkit-animation-name: spin-16;
                animation-name: spin-16;
        -webkit-animation-duration: 0.48s;
                animation-duration: 0.48s;
      }
      
      @-webkit-keyframes spin-17 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 17);
        }
      }
      
      @keyframes spin-17 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 17);
        }
      }
      .god .wrap > .span-17 {
        -webkit-animation-name: spin-17;
                animation-name: spin-17;
        -webkit-animation-duration: 0.51s;
                animation-duration: 0.51s;
      }
      
      @-webkit-keyframes spin-18 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 18);
        }
      }
      
      @keyframes spin-18 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 18);
        }
      }
      .god .wrap > .span-18 {
        -webkit-animation-name: spin-18;
                animation-name: spin-18;
        -webkit-animation-duration: 0.54s;
                animation-duration: 0.54s;
      }
      
      @-webkit-keyframes spin-19 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 19);
        }
      }
      
      @keyframes spin-19 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 19);
        }
      }
      .god .wrap > .span-19 {
        -webkit-animation-name: spin-19;
                animation-name: spin-19;
        -webkit-animation-duration: 0.57s;
                animation-duration: 0.57s;
      }
      
      @-webkit-keyframes spin-20 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 20);
        }
      }
      
      @keyframes spin-20 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 20);
        }
      }
      .god .wrap > .span-20 {
        -webkit-animation-name: spin-20;
                animation-name: spin-20;
        -webkit-animation-duration: 0.6s;
                animation-duration: 0.6s;
      }
      
      @-webkit-keyframes spin-21 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 21);
        }
      }
      
      @keyframes spin-21 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 21);
        }
      }
      .god .wrap > .span-21 {
        -webkit-animation-name: spin-21;
                animation-name: spin-21;
        -webkit-animation-duration: 0.63s;
                animation-duration: 0.63s;
      }
      
      @-webkit-keyframes spin-22 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 22);
        }
      }
      
      @keyframes spin-22 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 22);
        }
      }
      .god .wrap > .span-22 {
        -webkit-animation-name: spin-22;
                animation-name: spin-22;
        -webkit-animation-duration: 0.66s;
                animation-duration: 0.66s;
      }
      
      @-webkit-keyframes spin-23 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 23);
        }
      }
      
      @keyframes spin-23 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 23);
        }
      }
      .god .wrap > .span-23 {
        -webkit-animation-name: spin-23;
                animation-name: spin-23;
        -webkit-animation-duration: 0.69s;
                animation-duration: 0.69s;
      }
      
      @-webkit-keyframes spin-24 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 24);
        }
      }
      
      @keyframes spin-24 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 24);
        }
      }
      .god .wrap > .span-24 {
        -webkit-animation-name: spin-24;
                animation-name: spin-24;
        -webkit-animation-duration: 0.72s;
                animation-duration: 0.72s;
      }
      
      @-webkit-keyframes spin-25 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 25);
        }
      }
      
      @keyframes spin-25 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 25);
        }
      }
      .god .wrap > .span-25 {
        -webkit-animation-name: spin-25;
                animation-name: spin-25;
        -webkit-animation-duration: 0.75s;
                animation-duration: 0.75s;
      }
      
      @-webkit-keyframes spin-26 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 26);
        }
      }
      
      @keyframes spin-26 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 26);
        }
      }
      .god .wrap > .span-26 {
        -webkit-animation-name: spin-26;
                animation-name: spin-26;
        -webkit-animation-duration: 0.78s;
                animation-duration: 0.78s;
      }
      
      @-webkit-keyframes spin-27 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 27);
        }
      }
      
      @keyframes spin-27 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 27);
        }
      }
      .god .wrap > .span-27 {
        -webkit-animation-name: spin-27;
                animation-name: spin-27;
        -webkit-animation-duration: 0.81s;
                animation-duration: 0.81s;
      }
      
      @-webkit-keyframes spin-28 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 28);
        }
      }
      
      @keyframes spin-28 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 28);
        }
      }
      .god .wrap > .span-28 {
        -webkit-animation-name: spin-28;
                animation-name: spin-28;
        -webkit-animation-duration: 0.84s;
                animation-duration: 0.84s;
      }
      
      @-webkit-keyframes spin-29 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 29);
        }
      }
      
      @keyframes spin-29 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 29);
        }
      }
      .god .wrap > .span-29 {
        -webkit-animation-name: spin-29;
                animation-name: spin-29;
        -webkit-animation-duration: 0.87s;
                animation-duration: 0.87s;
      }
      
      @-webkit-keyframes spin-30 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 30);
        }
      }
      
      @keyframes spin-30 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 30);
        }
      }
      .god .wrap > .span-30 {
        -webkit-animation-name: spin-30;
                animation-name: spin-30;
        -webkit-animation-duration: 0.9s;
                animation-duration: 0.9s;
      }
      
      @-webkit-keyframes spin-31 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 31);
        }
      }
      
      @keyframes spin-31 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 31);
        }
      }
      .god .wrap > .span-31 {
        -webkit-animation-name: spin-31;
                animation-name: spin-31;
        -webkit-animation-duration: 0.93s;
                animation-duration: 0.93s;
      }
      
      @-webkit-keyframes spin-32 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 32);
        }
      }
      
      @keyframes spin-32 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 32);
        }
      }
      .god .wrap > .span-32 {
        -webkit-animation-name: spin-32;
                animation-name: spin-32;
        -webkit-animation-duration: 0.96s;
                animation-duration: 0.96s;
      }
      
      @-webkit-keyframes spin-33 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 33);
        }
      }
      
      @keyframes spin-33 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 33);
        }
      }
      .god .wrap > .span-33 {
        -webkit-animation-name: spin-33;
                animation-name: spin-33;
        -webkit-animation-duration: 0.99s;
                animation-duration: 0.99s;
      }
      
      @-webkit-keyframes spin-34 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 34);
        }
      }
      
      @keyframes spin-34 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 34);
        }
      }
      .god .wrap > .span-34 {
        -webkit-animation-name: spin-34;
                animation-name: spin-34;
        -webkit-animation-duration: 1.02s;
                animation-duration: 1.02s;
      }
      
      @-webkit-keyframes spin-35 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 35);
        }
      }
      
      @keyframes spin-35 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 35);
        }
      }
      .god .wrap > .span-35 {
        -webkit-animation-name: spin-35;
                animation-name: spin-35;
        -webkit-animation-duration: 1.05s;
                animation-duration: 1.05s;
      }
      
      @-webkit-keyframes spin-36 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 36);
        }
      }
      
      @keyframes spin-36 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 36);
        }
      }
      .god .wrap > .span-36 {
        -webkit-animation-name: spin-36;
                animation-name: spin-36;
        -webkit-animation-duration: 1.08s;
                animation-duration: 1.08s;
      }
      
      @-webkit-keyframes spin-37 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 37);
        }
      }
      
      @keyframes spin-37 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 37);
        }
      }
      .god .wrap > .span-37 {
        -webkit-animation-name: spin-37;
                animation-name: spin-37;
        -webkit-animation-duration: 1.11s;
                animation-duration: 1.11s;
      }
      
      @-webkit-keyframes spin-38 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 38);
        }
      }
      
      @keyframes spin-38 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 38);
        }
      }
      .god .wrap > .span-38 {
        -webkit-animation-name: spin-38;
                animation-name: spin-38;
        -webkit-animation-duration: 1.14s;
                animation-duration: 1.14s;
      }
      
      @-webkit-keyframes spin-39 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 39);
        }
      }
      
      @keyframes spin-39 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 39);
        }
      }
      .god .wrap > .span-39 {
        -webkit-animation-name: spin-39;
                animation-name: spin-39;
        -webkit-animation-duration: 1.17s;
                animation-duration: 1.17s;
      }
      
      @-webkit-keyframes spin-40 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 40);
        }
      }
      
      @keyframes spin-40 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 40);
        }
      }
      .god .wrap > .span-40 {
        -webkit-animation-name: spin-40;
                animation-name: spin-40;
        -webkit-animation-duration: 1.2s;
                animation-duration: 1.2s;
      }
      
      @-webkit-keyframes spin-41 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 41);
        }
      }
      
      @keyframes spin-41 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 41);
        }
      }
      .god .wrap > .span-41 {
        -webkit-animation-name: spin-41;
                animation-name: spin-41;
        -webkit-animation-duration: 1.23s;
                animation-duration: 1.23s;
      }
      
      @-webkit-keyframes spin-42 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 42);
        }
      }
      
      @keyframes spin-42 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 42);
        }
      }
      .god .wrap > .span-42 {
        -webkit-animation-name: spin-42;
                animation-name: spin-42;
        -webkit-animation-duration: 1.26s;
                animation-duration: 1.26s;
      }
      
      @-webkit-keyframes spin-43 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 43);
        }
      }
      
      @keyframes spin-43 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 43);
        }
      }
      .god .wrap > .span-43 {
        -webkit-animation-name: spin-43;
                animation-name: spin-43;
        -webkit-animation-duration: 1.29s;
                animation-duration: 1.29s;
      }
      
      @-webkit-keyframes spin-44 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 44);
        }
      }
      
      @keyframes spin-44 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 44);
        }
      }
      .god .wrap > .span-44 {
        -webkit-animation-name: spin-44;
                animation-name: spin-44;
        -webkit-animation-duration: 1.32s;
                animation-duration: 1.32s;
      }
      
      @-webkit-keyframes spin-45 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 45);
        }
      }
      
      @keyframes spin-45 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 45);
        }
      }
      .god .wrap > .span-45 {
        -webkit-animation-name: spin-45;
                animation-name: spin-45;
        -webkit-animation-duration: 1.35s;
                animation-duration: 1.35s;
      }
      
      @-webkit-keyframes spin-46 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 46);
        }
      }
      
      @keyframes spin-46 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 46);
        }
      }
      .god .wrap > .span-46 {
        -webkit-animation-name: spin-46;
                animation-name: spin-46;
        -webkit-animation-duration: 1.38s;
                animation-duration: 1.38s;
      }
      
      @-webkit-keyframes spin-47 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 47);
        }
      }
      
      @keyframes spin-47 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 47);
        }
      }
      .god .wrap > .span-47 {
        -webkit-animation-name: spin-47;
                animation-name: spin-47;
        -webkit-animation-duration: 1.41s;
                animation-duration: 1.41s;
      }
      
      @-webkit-keyframes spin-48 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 48);
        }
      }
      
      @keyframes spin-48 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 48);
        }
      }
      .god .wrap > .span-48 {
        -webkit-animation-name: spin-48;
                animation-name: spin-48;
        -webkit-animation-duration: 1.44s;
                animation-duration: 1.44s;
      }
      
      @-webkit-keyframes spin-49 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 49);
        }
      }
      
      @keyframes spin-49 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 49);
        }
      }
      .god .wrap > .span-49 {
        -webkit-animation-name: spin-49;
                animation-name: spin-49;
        -webkit-animation-duration: 1.47s;
                animation-duration: 1.47s;
      }
      
      @-webkit-keyframes spin-50 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 50);
        }
      }
      
      @keyframes spin-50 {
        from {
          top: 0;
        }
        to {
          top: calc(-73px * 50);
        }
      }
      .god .wrap > .span-50 {
        -webkit-animation-name: spin-50;
                animation-name: spin-50;
        -webkit-animation-duration: 1.5s;
                animation-duration: 1.5s;
      }
      
      .btns {
        display: flex;
        margin-bottom: 3rem;
      }
      
      .vegetarian {
        padding-right: 2px;
        color: #689F38;
      }
      
      .btn-start {
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        z-index: 1;
        margin-top: 5vh;
        margin-bottom: 2vh;
        margin-left: 2rem;
        padding: 1rem 2rem;
        width: 100%;
        border: 1px solid rgba(41, 44, 55, 0.27);
        text-decoration: none;
        color: rgba(41, 44, 55, 0.54);
      }
      .btn-start::after {
        content: "轉動命運輪盤";
        line-height: 1;
      }
      .btn-start:hover {
        color: #CD0505;
      }
      .btn-start.not-allow {
        pointer-events: none;
      }
      .btn-start.not-allow::after {
        font-family: "FontAwesome";
        content: "\f110";
        -webkit-animation: fa-spin 2s infinite linear;
                animation: fa-spin 2s infinite linear;
      }
      .btn-start.not-allow:hover {
        color: #CCC;
      }
      
      @media screen and (max-width: 768px) {
        .btn-start {
          background-color: rgb(255, 255, 255);
        }
      }
      .btn-start .line, .btn-start.not-allow .line {
        position: absolute;
        background: #CD0505;
        -webkit-transform: scale(0);
                transform: scale(0);
        transition: -webkit-transform 0.1s ease;
        transition: transform 0.1s ease;
        transition: transform 0.1s ease, -webkit-transform 0.1s ease;
      }
      .btn-start .line.-h, .btn-start.not-allow .line.-h {
        width: 100%;
        height: 2px;
      }
      .btn-start .line.-v, .btn-start.not-allow .line.-v {
        width: 2px;
        height: 100%;
      }
      .btn-start .line.top, .btn-start.not-allow .line.top {
        top: -2px;
        left: 0;
        -webkit-transform-origin: left;
                transform-origin: left;
      }
      .btn-start .line.right, .btn-start.not-allow .line.right {
        top: 0;
        right: -2px;
        -webkit-transform-origin: top;
                transform-origin: top;
      }
      .btn-start .line.bottom, .btn-start.not-allow .line.bottom {
        bottom: -2px;
        right: 0;
        -webkit-transform-origin: right;
                transform-origin: right;
      }
      .btn-start .line.left, .btn-start.not-allow .line.left {
        bottom: 0;
        left: -2px;
        -webkit-transform-origin: bottom;
                transform-origin: bottom;
      }
      
      .btn-start.not-allow {
        border-color: transparent;
      }
      .btn-start.not-allow, .btn-start.not-allow:hover {
        color: #CD0505;
      }
      .btn-start.not-allow .line {
        background: transparent;
      }
      
      .btn-start .line.top, .btn-start.not-allow .line.top {
        transition-delay: 0.3s;
      }
      .btn-start .line.right, .btn-start.not-allow .line.right {
        transition-delay: 0.2s;
      }
      .btn-start .line.bottom, .btn-start.not-allow .line.bottom {
        transition-delay: 0.1s;
      }
      .btn-start .line.left, .btn-start.not-allow .line.left {
        transition-delay: 0;
      }
      
      .btn-start:hover .line, .btn-start.not-allow:hover .line {
        -webkit-transform: scale(1);
                transform: scale(1);
      }
      .btn-start:hover .line.top, .btn-start.not-allow:hover .line.top {
        transition-delay: 0s;
      }
      .btn-start:hover .line.right, .btn-start.not-allow:hover .line.right {
        transition-delay: 0.1s;
      }
      .btn-start:hover .line.bottom, .btn-start.not-allow:hover .line.bottom {
        transition-delay: 0.2s;
      }
      .btn-start:hover .line.left, .btn-start.not-allow:hover .line.left {
        transition-delay: 0.3s;
      }
      
      .toggle {
        position: relative;
        display: inline-block;
        width: 100px;
        height: 54px;
      }
      .toggle input {
        display: none;
      }
      
      .button {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #ccc;
        transition: 0.4s;
        box-shadow: 0 2px 1px 0 rgba(255, 255, 255, 0.5), inset 0 1px 3px 0 rgba(0, 0, 0, 0.2);
      }
      .button:before {
        position: absolute;
        content: "";
        height: 46px;
        width: 46px;
        left: 4px;
        bottom: 4px;
        background-color: white;
        transition: 0.4s;
        box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.2), 0px 4px 23px 0 rgba(0, 0, 0, 0.08), -2px 4px 4px 0 rgba(0, 0, 0, 0.1);
      }
      
      input:checked + .button {
        background-color: #8BC34A;
      }
      input:focus + .button {
        box-shadow: 0 0 1px #2196F3;
      }
      input:checked + .button:before, input:checked + .button:after {
        -webkit-transform: translateX(46px);
                transform: translateX(46px);
      }
      input:checked + .button:after {
        color: #689F38;
      }
      
      .button.round {
        border-radius: 34px;
      }
      .button.round:before {
        border-radius: 50%;
      }
      .button.round:after {
        font-family: "FontAwesome";
        content: "\f18c";
        position: absolute;
        left: 4px;
        bottom: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        height: 46px;
        width: 46px;
        font-size: 1.5rem;
        color: #ccc;
        transition: 0.4s;
      }
      
      .map {
        width: 100%;
      }
      .map iframe {
        width: 100%;
        height: 22.5vw;
        transition: all 0.5s ease;
      }
      .map .hidden {
        visibility: hidden;
        opacity: 0;
      }
      
      @media screen and (max-width: 768px) {
        .map iframe {
          min-height: 30vh;
        }
      }
      .github {
        position: fixed;
        left: 0;
        bottom: 0;
        display: flex;
        width: 100px;
        height: 100px;
      }
      .github::before {
        content: "";
        width: 0;
        height: 0;
        border-style: solid;
        border-width: 100px 0 0 100px;
        border-color: transparent transparent transparent #6e5494;
      }
      .github .fa {
        position: absolute;
        left: 10px;
        bottom: 5px;
        font-size: 3rem;
        color: #FFF;
      }
      
      @media screen and (max-width: 768px) {
        .github {
          width: 70px;
          height: 70px;
        }
        .github::before {
          border-width: 70px 0 0 70px;
        }
        .github .fa {
          left: 8px;
          bottom: 4px;
          font-size: 2rem;
        }
      }
      .search-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        border: 0;
      }
      
      </style>
      
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
      function getAllUrlParams(url) {
      
        // get query string from url (optional) or window
        var queryString = url ? url.split('?')[1] : window.location.search.slice(1);
      
        // we'll store the parameters here
        var obj = {};
      
        // if query string exists
        if (queryString) {
      
          // stuff after # is not part of query string, so get rid of it
          queryString = queryString.split('#')[0];
      
          // split our query string into its component parts
          var arr = queryString.split('&');
      
          for (var i = 0; i < arr.length; i++) {
            // separate the keys and the values
            var a = arr[i].split('=');
      
            // set parameter name and value (use 'true' if empty)
            var paramName = a[0];
            var paramValue = typeof(a[1]) === 'undefined' ? true : a[1];
            /** 
            // (optional) keep case consistent
            paramName = paramName.toLowerCase();
            if (typeof paramValue === 'string')
              paramValue = paramValue.toLowerCase();
            **/
            // if the paramName ends with square brackets, e.g. colors[] or colors[2]
            if (paramName.match(/\[(\d+)?\]$/)) {
      
              // create key if it doesn't exist
              var key = paramName.replace(/\[(\d+)?\]/, '');
              if (!obj[key])
                obj[key] = [];
      
              // if it's an indexed array e.g. colors[2]
              if (paramName.match(/\[\d+\]$/)) {
                // get the index value and add the entry at the appropriate position
                var index = /\[(\d+)\]/.exec(paramName)[1];
                obj[key][index] = paramValue;
              } else {
                // otherwise add the value to the end of the array
                obj[key].push(paramValue);
              }
            } else {
              // we're dealing with a string
              if (!obj[paramName]) {
                // if it doesn't exist, create property
                obj[paramName] = paramValue;
              } else if (obj[paramName] && typeof obj[paramName] === 'string') {
                // if property does exist and it's a string, convert it to an array
                obj[paramName] = [obj[paramName]];
                obj[paramName].push(paramValue);
              } else {
                // otherwise add the property
                obj[paramName].push(paramValue);
              }
            }
          }
        }
      
        return obj;
      };
      
      function sendPost(url, _params) {
      
        var form = document.createElement("form");
        // 設定表單的一些屬性，包含網頁接收伺服器回應的頁面或框架
        form.setAttribute("method", "post");
        form.setAttribute("action", url);
        //form.setAttribute("target", "Iframe1");
      
        // 建立隱藏的表單控制項
        for (var key in _params) {
          var hiddenField = document.createElement("input");
          hiddenField.setAttribute("type", "hidden");
          hiddenField.setAttribute("name", key);
          hiddenField.setAttribute("value", _params[key]);
          form.appendChild(hiddenField);
          //console.log(key);
        }
      
        // 隱藏的submit按鈕，預防瀏覽器不支援模糊的表單設計。（可不用）
        var hiddenSubmit = document.createElement("input");
        hiddenSubmit.setAttribute("type", "submit");
        hiddenSubmit.setAttribute("style", "display:none;");
        form.appendChild(hiddenSubmit);
      
        // 將表單加入網頁中
        document.body.appendChild(form);
      
        // 送出請求
        //form.submit();
        return new Promise(function(resolve,reject){
          fetch(`${url}`, {
            method: "POST",
            redirect: "follow", 
            // mode: "no-cors", 
            // cache: "no-cache",
            headers: {
              "Content-Type": "text/plain",
            },
            // credentials: "include",
            body: JSON.stringify(
              _params
              // {"to_add": result.map(x=> [x, prize_target])}
            )
          })
          .then(response => response.text())
          .then(context => {
            var data = JSON.parse(context);
            resolve(data);
          });
      
        })
      };
      
      function retry(maxRetries, fn) {
        return fn().catch(function(err) { 
          if (maxRetries <= 0) {
          throw err;
          }
          return retry(maxRetries - 1, fn); 
        });
      };
      
      // Builds the HTML Table out of myList.
      function buildHtmlTable(selector,myList) {
        var columns = addAllColumnHeaders(myList, selector);
      
        for (var i = 0; i < myList.length; i++) {
        var row$ = $('<tr/>');
        for (var colIndex = 0; colIndex < columns.length; colIndex++) {
          var cellValue = myList[i][columns[colIndex]];
          if (cellValue == null) cellValue = "";
          row$.append($('<td/>').html(cellValue));
        }
        $(selector).append(row$);
        }
      };
      
      // Adds a header row to the table and returns the set of columns.
      // Need to do union of keys from all records as some records may not contain
      // all records.
      function addAllColumnHeaders(myList, selector) {
        var columnSet = [];
        var headerTr$ = $('<tr/>');
      
        for (var i = 0; i < myList.length; i++) {
        var rowHash = myList[i];
        for (var key in rowHash) {
          if ($.inArray(key, columnSet) == -1) {
          columnSet.push(key);
          headerTr$.append($('<th/>').html(key));
          }
        }
        }
        $(selector).append(headerTr$);
      
        return columnSet;
      };
      
      function getToken(liffId) {
        return new Promise(function(resolve,reject){
          liff.init({
                      liffId: liffId,
                      withLoginOnExternalBrowser: true
                  }).then(function (data) {
            // if (!liff.isLoggedIn()) {
            //   window.location="https://access.line.me/oauth2/v2.1/authorize?response_type=code&client_id=2006657937&redirect_uri=https%3A%2F%2Fscript.google.com%2Fmacros%2Fs%2FAKfycbzlbEDgSYeBRV2l27H4_gn4eITQGDoJzRPlFbGCnxzO1IvmCjCUqlI0KgN4THTEHTJN%2Fexec&state=2025&scope=profile%20openid";
            // } else {
              liff.getProfile().then(function (profile) {
                var params = {};
                params['userId'] = profile.userId;
                const accessToken =  liff.getAccessToken();
                if (!accessToken) {
                  params['accessToken'] = 'Error';
                }
                params['accessToken'] = accessToken;
                //console.log(params);
                resolve(params);
              }).catch(function (error) {
                window.alert("Error getting profile: " + error);
                reject(params);
              });
            // }
          });
        });
      };
      </script>
  </head>
  <body style="overflow: hidden;background-color: unset;">
  <!-- <body style="-webkit-transform: scale(1.25);width:80%;height:80%;transform-origin: 0% 0%;overflow: hidden;"> -->
    <!-- <iframe style="display:none" name="hidden_submit" src="<?!= ScriptApp.getService().getUrl(); ?>?role=slave"></iframe> -->
    <!-- <div style="height:96vh;background-image: url('https://lh6.googleusercontent.com/z3uDSC3b3BkvXoXrHHuP56maTM6wiowO23fObGiVwtMfHOOQvoyZghLPG12cTHPFoRxsTDnPRJXNodR4EUwxLJqu6cL_fpLHuJKYDDAOuVBpQiruCBScDzOIxlCkD-3SNmbUW-vfcQ');"> -->
      <div id="loading" class="w-100 h-100 position-absolute bg-dark" style="opacity: 0.9;">
	  <div class="position-absolute top-50 start-50 translate-middle" style="text-align: center;"\>
	  <div class="spinner-border text-primary" id="spinner" role="status" style="width: 5rem;height: 5rem;">
	  <span class="sr-only"></span>
	  </div>
	  <div class="fs-1 text-white">登入中...</div>
	  </div>
	  </div>
	  <div style="height:100vh;background-image: url('https://i.imgur.com/TQEYf25.jpg');background-size: 100% auto;background-repeat: repeat-y;">
        <div class="p-3 bd-highlight justify-content-center">         
            <div id='output'></div>
            <div class="row g-2">
            <div class="col-auto w-30">
            <select name="prize_sn" id="prize_sn" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" onclick="cancel_ready();" onchange="gen_box_options();">
                <option value="" selected disabled>請選擇獎項</option>
            </select>
            </div>
            <div class="col-auto w-40">
            <select name="box_no" id="box_no" class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" onclick="cancel_ready();" onchange="document.getElementById('shoot').disabled = false;document.getElementById('drawn').style.display = 'none';gen_draw_qty_options();">
              <option value="" selected disabled>請選擇箱別</option>
            </select>
            </div>
            <div class="col-auto">
              <div class="btn-group btn-group-lg" id="draw_qty" role="group" onclick="cancel_ready();" aria-label="Basic radio toggle button group">
              </div>
            </div>
	    <div class="col-auto">
                   <button id="shoot" class="btn btn-dark btn-lg" type="button" onclick="lucky_draw();" disabled>開始抽獎</button>
            </div>
            </div>
            <div id="container6" style="height:80vh;width: 100vw">
            <!-- <div id="container6" style="height:60vh;width: 100vw;"> -->
                <div id="drawing_single" style="text-align: center;text-align: -webkit-center;width: 100%;display: none;">
                    <div class="god">
                      <h1>
                        <span class="wrap no1">
                          <span>分店</span>
                        </span>
                        <span class="wrap no2">
                          <span>抽獎序號</span>
                        </span>
                        <span class="wrap no3">
                          <span>中獎人</span>
                        </span>
                      </h1>
                    </div>
                </div>
                <div id="drawn" style="display: none;">
                    <div style="text-align: center;width: 100%;">
                        <span id="prize_name" class="btn btn-success btn-lg"></span>
                        <br><br>
                    </div>
                    <!-- <div id="drawn_list" style="overflow: auto;height: 300px;"> -->
                    <div id="drawn_list" style="justify-self: center;width: 75%;height: 79vh;overflow: auto;">
                    </div>
                </div>
            </div>
            <br>
<!--             <div class="d-grid gap-2">
                   <button id="shoot" class="btn btn-primary" type="button" onclick="lucky_draw();" disabled>開始抽獎</button>
            </div> -->
            
            <!-- <form target="hidden_submit" action="<?!= ScriptApp.getService().getUrl(); ?>" method="post" id="happy-lottery-form" name="happy-lottery-form" class="validate"> -->
            <!-- <form target="_self" action="<?!= ScriptApp.getService().getUrl(); ?>" method="post" id="happy-lottery-form" name="happy-lottery-form" class="validate">
            <input type="text" id="ids" name="ids" class="visually-hidden d-block"/>
            <input type="text" id="prizes" name="prizes" class="visually-hidden d-block"/>
            <input type="submit" value="開始抽獎" name="subscribe" id="subscribe" class="visually-hidden btn btn-primary w-100">
            </form> -->




        </div>
    </div>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
      var is_ready = false;
      var params = new URL(document.location.toString()).searchParams;
      if (params.has("liffRedirectUri")) {
        params = new URL(decodeURIComponent(params.get("liffRedirectUri"))).searchParams;
      }
      if (!params.has("liff") || !params.has("sid")) {
        Swal.fire({
                title: '系統錯誤',
                text: "無效參數",
                icon: "error"
        });
        pause
      }

      var liffId = params.get("liff");
      var url = `https://script.google.com/macros/s/${params.get("sid")}/exec`;
      var text;
      var prize_result;
      var last_winner_list = "";
      if (last_winner_list) {
        last_winner_list = JSON.parse(last_winner_list);
      }

      Array.prototype.random = function(qty){
        return new Promise((resolve, reject) => {
          // const rr = this[Math.floor(Math.random()*this.length)];
          const rr = shuffle(this).slice(0,qty);
          sleep(300).then(() => {
            resolve(rr);
          });
        });
      }

      Array.prototype.random_lottery = function(qty){
        return new Promise((resolve, reject) => {
          const rr = shuffle(this).slice(0,qty);
	  sleep(300).then(() => {
            resolve(rr);
          });
          // const rr = shuffle(this);
          // var result = {};
          // for(i=0;i<rr.length;i++){
          //   if (!result[lottery_buyer_list[rr[i]]]) {
          //       result[lottery_buyer_list[rr[i]]] = rr[i];
          //   }
          //   if (Object.keys(result).length===qty) {
          //       break
          //   }
          // }
          // sleep(3000).then(() => {
          //   resolve(Object.values(result));
          // });
        });
      }
      

      function sleep (time) {
        return new Promise((resolve) => setTimeout(resolve, time));
      }

      function shuffle(o){ //try this shuffle function
          for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
          return o;
      };
      var slave_mode = false;
      var prizes = {};
      var prizes_dict = {};
      var shop_list = {};
      var winner_list = {};
      var name_list = {};
      var lottery_buyer_list = {};
      var special_name_list = {};
      var entire_name_list = {};
      var lottery_winner_list = {};
      var special_winner_list = {};
      var entire_winner_list = {};
      var group_list = {};
      var toggle;
    
      function load_config() {
        lines = text.split("\n");
        for(i=0;i<lines.length;i++){
          if (lines[i].match(/^\[prizes|shop_list|winner_list|name_list|lottery_buyer_list|special_name_list|entire_name_list|lottery_winner_list|special_winner_list|entire_winner_list|group_list\]$/g)) {
            target = lines[i];
            headers = null;
          } else if (lines[i] === "") {
            continue
          } else if (!headers) {
            headers = lines[i].split(",");
          } else {
            tmp = Object.assign( ...lines[i].split(",").map((v, i) => ({[headers[i]]: v})));
            switch (target) {
              case '[prizes]':
                prizes[tmp["獎項編號"]]=tmp;
                if (prizes_dict[tmp["獎項"]]) {
                  prizes_dict[tmp["獎項"]][tmp["獎項編號"]]=tmp;
                } else {
                  prizes_dict[tmp["獎項"]] = {};
                  prizes_dict[tmp["獎項"]][tmp["獎項編號"]]=tmp;
                }
                break
              case '[shop_list]':
                shop_list[tmp["店名"]]=tmp;
                break
              case '[winner_list]':
                winner_list[tmp["身分證號"]]=tmp;
                break
              case '[lottery_buyer_list]':
                lottery_buyer_list[tmp["抽獎序號"]]=tmp["身分證號"];
                break
              case '[name_list]':
                name_list[tmp["身分證號"]]=tmp;
                break
	      case '[special_name_list]':
                special_name_list[tmp["身分證號"]]=tmp;
                break
	      case '[entire_name_list]':
                entire_name_list[tmp["身分證號"]]=tmp;
                break
	      case '[lottery_winner_list]':
                lottery_winner_list[tmp["抽獎序號"]]=tmp;
                break
	      case '[special_winner_list]':
                special_winner_list[tmp["身分證號"]]=tmp;
                break
	      case '[entire_winner_list]':
                entire_winner_list[tmp["身分證號"]]=tmp;
                break
	      case '[group_list]':
                group_list[tmp["桶別"]]=tmp["區"];
                break

              // case '[last_winner_list]':
              //   last_winner_list[tmp["身分證號"]]=tmp;
              //   break
              default:
                console.log(`Error`);
            }
          }
        }
        gen_prizes_options();
        if (last_winner_list) {
            //中獎名單
            prize_target = Object.values(last_winner_list)[0]['獎項編號'];
            document.getElementById("drawn").style.display = "inline";
            var span = document.getElementById("prize_name");
            span.innerText = span.textContent = prizes[prize_target]["獎項"].replace(/(\d)(?=(\d{3})+$)/g, '$1,') + '-中獎名單';
            var drawn_list = document.getElementById("drawn_list");
            drawn_list.innerHTML = gen_list(Object.keys(last_winner_list), false);
            last_winner_list = {};
        }
        toggle = [Object.values(shop_list).map(x=>x["桶別"]), Object.values(shop_list).map(x=>x["店名"]), Object.values(name_list).map(x=>x["姓名"])];
      }
      
      function remove_prizes_options() {
        document.querySelectorAll('#prize_sn option').forEach(option => option.remove());
        var select = document.getElementById("prize_sn");
        var _option = document.createElement("option");
        _option.value = "";
        _option.innerHTML = "請選擇獎項";
        _option.selected = true;
        _option.disabled = true;
        select.appendChild(_option);
      }

      function remove_box_options() {
        document.querySelectorAll('#box_no option').forEach(option => option.remove());
        var select = document.getElementById("box_no");
        var _option = document.createElement("option");
        _option.value = "";
        _option.innerHTML = "請選擇箱別";
        _option.selected = true;
        _option.disabled = true;
        select.appendChild(_option);
      }

      function remove_draw_qty_options() {
        document.getElementById("draw_qty").innerHTML="";
      }

      function gen_prizes_options() {
        remove_prizes_options();
        remove_box_options();
        remove_draw_qty_options();
        var select = document.getElementById("prize_sn");
        var tmp;
        Object.keys(prizes_dict).forEach(_prize => {
          tmp = prizes_dict[_prize];
          quota = Object.values(tmp).map(x=>parseInt(x["名額"])).reduce((a, b) => a + b, 0);
          used = Object.values(tmp).map(x=>parseInt(x["已抽獎數"])).reduce((a, b) => a + b, 0);
          var option = document.createElement("option");
          option.value = _prize;
          if (quota > used) {
            option.innerHTML = `${_prize.replace(/(\d)(?=(\d{3})+$)/g, '$1,')} (名額:${quota}，已抽:${used})`;
          } else {
            option.innerHTML = `${_prize.replace(/(\d)(?=(\d{3})+$)/g, '$1,')} (名額:${quota}，完成抽獎)`;
            option.disabled = true;
          }
          
          select.appendChild(option);
          document.getElementById("shoot").disabled=true;
        });
        document.getElementById('prize_sn').disabled = false;
      }

      function gen_box_options() {
        remove_box_options();
        remove_draw_qty_options();
        var prize = document.getElementById("prize_sn").value;
        var select = document.getElementById("box_no");
        Object.values(prizes_dict[prize]).forEach(box => {
          quota = parseInt(box["名額"]);
          used = parseInt( box["已抽獎數"]);
          var option = document.createElement("option");
          option.value = box["獎項編號"];
          // option.setAttribute("quota", quota);
          // option.setAttribute("prize_target", box["獎項編號"]);
          // option.setAttribute("draw_all", false);
          // option.setAttribute("draw_limit", box["桶別"]);
	  if (group_list[box["桶別"]]) {
	     var _group = `${group_list[box["桶別"]]}，`;
	  } else {
	     var _group = "";
	  }
          
          if (quota > used) {
            option.innerHTML = `${box["桶別"]} (${_group}名額:${quota}，已抽:${used})`;
          } else {
            option.innerHTML = `${box["桶別"]} (${_group}名額:${quota}，完成抽獎)`;
            option.disabled = true;
          }
          select.appendChild(option);
          document.getElementById("shoot").disabled=true;
        });
        

      }

      function gen_draw_qty_options() {
        var temp = '<input type="radio" class="btn-check" name="qty" id="draw_all" autocomplete="off" value="999" checked>' +
        '<label class="btn btn-light btn-outline-dark" for="draw_all">全抽</label>';
        const prize_target = document.getElementById("box_no").selectedOptions[0].value;
        const quota = parseInt(prizes[prize_target]["名額"]);
        const draw_limit = parseInt(prizes[prize_target]["已抽獎數"]);
        const avaible_qty = quota - draw_limit;
        var target_qty = [...Array.from(Array(21).keys()).slice(1).map(x=> 5*x), 4, 3, 2, 1];
        target_qty.sort(function(a, b) {
          return b - a;
        });
        target_qty.filter(x=> x<avaible_qty && x<=10).forEach(qty => {
          temp += `<input type="radio" class="btn-check" name="qty" id="draw_${qty}" autocomplete="off" value="${qty}">` +
          `<label class="btn btn-light btn-outline-dark" for="draw_${qty}">${qty}</label>`;
        });
        document.getElementById("draw_qty").innerHTML = temp;
      }

      function gen_list(result, is_lottery) {
        var html = '<table class="table panel-body" style="place-self: center;">' +
        '<thead>' +
        '<tr>' +
        '<th scope="col">No.</th>' +
        '<th scope="col">區別</th>' +
        '<th scope="col">店名</th>' +
        '<th scope="col">中獎姓名</th>' +
        `<th scope="col">身分證${is_lottery?"(序號)":""}</th>` +
        '</tr>' +
        '</thead>' +
        '<tbody>';
        for(i=0;i<result.length;i++){
          html += '<tr>' +
          `<th scope="row">${i+1}</th>` +
          `<td>${name_list[is_lottery?lottery_buyer_list[result[i]]:result[i]]['區']}</td>` +
          `<td>${name_list[is_lottery?lottery_buyer_list[result[i]]:result[i]]['店名']}</td>` +
          `<td>${name_list[is_lottery?lottery_buyer_list[result[i]]:result[i]]['姓名']}</td>` +
          `<td>${name_list[is_lottery?lottery_buyer_list[result[i]]:result[i]]['身分證號'].slice(0,3)}XXX${name_list[is_lottery?lottery_buyer_list[result[i]]:result[i]]['身分證號'].slice(6,10)}${is_lottery?"("+result[i]+")":""}</td>` +
          '</tr>' +
          '<tr>';
        }
        html += '</tbody>' +
        '</table>';
        return html
      }

      function onSuccess(result) {
        const prize_target = document.getElementById("box_no").selectedOptions[0].value;
        getToken(liffId).then(function(params){
        fetch(url, {
          method: "POST",
          redirect: "follow", 
          // mode: "cors", 
          //cache: "no-cache",
          headers: {
          "Content-Type": "text/plain",
          },
          // credentials: "include",
          body: JSON.stringify(
          {"to_add": result.map(x=> [x, prize_target]),...params}
          )
        })
			.then(response => response.text())
			.then(context => {
			  //抽獎中
			  console.log(context);
			  document.getElementById("drawing_single").style.display = "none";
			  var chk = JSON.parse(context)["to_add"];
			  if (chk === "Failed") {
				Swal.fire({
				  title: "系統錯誤",
				  text: "請重新操作",
				  icon: "error",
				  showConfirmButton: false,
				  timer: 1500
				});
				gen_prizes_options();
			  } else {
				text = chk;
				load_config();
				gen_prizes_options();
				//中獎名單
				document.getElementById("drawn").style.display = "inline";
				var span = document.getElementById("prize_name");
                if (prizes[prize_target]["獎項編號"][0]!=="L") {
                    span.innerText = span.textContent = `${prizes[prize_target]["獎項"].replace(/(\d)(?=(\d{3})+$)/g, '$1,')}(${prizes[prize_target]["桶別"]}:${group_list[prizes[prize_target]["桶別"]]})-中獎名單`;
                    var drawn_list = document.getElementById("drawn_list");
                    console.log(result);
                    drawn_list.innerHTML = gen_list(result, false);
                } else {
                    span.innerText = span.textContent = `${prizes[prize_target]["獎項"].replace(/(\d)(?=(\d{3})+$)/g, '$1,')}-中獎名單`;
                    var drawn_list = document.getElementById("drawn_list");
                    console.log(result);
                    drawn_list.innerHTML = gen_list(result, true);
                }

			  }
			})
		})
      }

      function lucky_draw() {
        // if (typeof window.happy_lottery_tab === "function") {
        //   window.happy_lottery_tab();
        // }
        document.getElementById('prize_sn').disabled = true;
        document.getElementById('shoot').disabled = true;
        //即將開獎
        var prize_sn = document.getElementById("prize_sn").value;
        if (prize_sn === "") {
          alert("請選擇獎項");
        } else {
          const prize_target = document.getElementById("box_no").selectedOptions[0].value;

          // prizes
          // 獎項編號,桶別,獎項,名額,已抽名額

          // shop_list
          // 桶別,店名

          // name_list
          // 區別,店名,姓名,身分證號

          // lottery_buyer_list
          // 抽獎序號,身分證

          // winner_list
          // 身分證號,獎項編號,領取
          const quota = parseInt(prizes[prize_target]["名額"]);
          const draw_all = prizes[prize_target]["桶別"]==="全體";
          const draw_limit = parseInt(prizes[prize_target]["已抽獎數"]);
          var _qty = parseInt(document.querySelector('input[name="qty"]:checked').value);
          //抽獎中
          const qty = Math.min(_qty, quota - draw_limit);
          if (prize_target[0]==="L") {
            // const lottery_winner = Object.keys(lottery_winner_list).filter(y=> lottery_winner_list[y]["獎項編號"][0]==="L");
	    const lottery_winner = Object.keys(lottery_winner_list);
            // const target_list = Object.keys(lottery_buyer_list).filter(x=> !lottery_winner.includes(lottery_buyer_list[x]));
            const target_list = Object.keys(lottery_buyer_list).filter(x=> !lottery_winner.includes(x));
            document.getElementById("drawing_single").style.display = "inline";
            choose([target_list, ...toggle.slice(1)], ["序號","店名","中獎人"]);
            target_list.random_lottery(qty).then(x=> { onSuccess(x); });
          } else if (prize_target[0]==="S") {
	    const winner = Object.keys(special_winner_list);
            const target_list = Object.keys(special_name_list).filter(x=> !winner.includes(x));
            document.getElementById("drawing_single").style.display = "inline";
            choose(toggle, ["桶別","店名","中獎人"]);
            target_list.random(qty).then(x=> { onSuccess(x); });
	  } else if (prize_target[0]==="P" && prizes[prize_target]["桶別"]==="全員工") {
	    const winner = Object.keys(entire_winner_list);
            const target_list = Object.keys(entire_name_list).filter(x=> !winner.includes(x));
            document.getElementById("drawing_single").style.display = "inline";
            choose(toggle, ["桶別","店名","中獎人"]);
            target_list.random(qty).then(x=> { onSuccess(x); });
          } else if (draw_all) {
            // const winner = Object.keys(winner_list).filter(y=> winner_list[y]["獎項編號"][0]!=="L");
            const winner = Object.keys(winner_list);
            const target_list = Object.keys(name_list).filter(x=> !winner.includes(x));
            document.getElementById("drawing_single").style.display = "inline";
            choose(toggle, ["桶別","店名","中獎人"]);
            target_list.random(qty).then(x=> { onSuccess(x); });
            // target_list.random(qty).then(x=> { onSuccess_formpost(x); });
            // google.script.run.withSuccessHandler(onSuccess_mix).lucky_draw_mix(shop, prize_target, JSON.parse(<?= JSON.stringify(prizes[0]["prizes"]?prizes[0]["prizes"]:[]) ?>), JSON.parse(<?= JSON.stringify(prizes[0]["quota"]?prizes[0]["quota"]:[]) ?>), shop_idx);
          } else {
            // const winner = Object.keys(winner_list).filter(y=> winner_list[y]["獎項編號"][0]!=="L");
            const winner = Object.keys(winner_list);
            const target_list = Object.keys(name_list).filter(x=> shop_list[name_list[x]["店名"]]["桶別"]===prizes[prize_target]["桶別"]).filter(x=> !winner.includes(x));
            document.getElementById("drawing_single").style.display = "inline";
            choose(toggle, ["桶別","店名","中獎人"]);
            target_list.random(qty).then(x=> { onSuccess(x); });
            // target_list.random(qty).then(x=> { onSuccess_formpost(x); });
            // google.script.run.withSuccessHandler(onSuccess).lucky_draw(shop, prize_target, prize_sn, quota, shop_idx, draw_limit);
          }
        }
      }

      function onSuccess_formpost(ids) {
        
        prize_result = ids;
        const prize_target = document.getElementById("box_no").selectedOptions[0].value;
        var prizes = ids.map(x=>prize_target);
        if (slave_mode) {
          window.setStringifiedStorageItem('happy_lottery_slave', JSON.stringify({"ids":ids, "prizes":prizes}));
        } else {
          document.getElementById('ids').setAttribute("value", ids.join(','));
          document.getElementById('prizes').setAttribute("value", prizes.join(','));
          document.getElementById('subscribe').click();
        }
      }

      function choose(toggle, txt) {
        // 清空、插入選項
        for(let i = 0; i < toggle.length; i++) {
          var input = document.querySelector(`.wrap.no${i+1}`);
          input.innerHTML = '';
          for(let j = 0; j < toggle[i].length; j++) {
            input.insertAdjacentHTML('beforeend', '<span>' + toggle[i][j] + '</span>'); 
          }
        }

        // 加入動畫 class name
        const list1 = document.querySelectorAll('.wrap.no1> span');
        const list2 = document.querySelectorAll('.wrap.no2 > span');
        const list3 = document.querySelectorAll('.wrap.no3 > span');
        Array.prototype.forEach.call(list1, l => l.classList.add('span-10'));
        Array.prototype.forEach.call(list2, l => l.classList.add('span-10'));
        Array.prototype.forEach.call(list3, l => l.classList.add('span-10'));
        list1[0].innerText = txt[0];
        list2[0].innerText = txt[1];
        list3[0].innerText = txt[2];
      };

      window.messagesKey = 'happy_lottery_master';

      window.setStringifiedStorageItem = function (key, value) {
        localStorage.setItem(key, value);
      }

      window.handleNewMessage = function ({ key, newValue}) {
          if (key===window.messagesKey) {
            const prize_target = document.getElementById("box_no").selectedOptions[0].value;
            document.getElementById("drawing_single").style.display = "none";
            document.getElementById("drawn").style.display = "inline";
            if (text === "Failed") {
              Swal.fire({
                title: "系統錯誤",
                text: "請重新操作",
                icon: "error",
                showConfirmButton: false,
                timer: 1500
              });
              gen_prizes_options();
            } else {
              text = newValue;
              load_config();
              document.getElementById("drawn").style.display = "inline";
              var span = document.getElementById("prize_name");
              span.innerText = span.textContent = prizes[prize_target]["獎項"].replace(/(\d)(?=(\d{3})+$)/g, '$1,') + '-中獎名單';
              var drawn_list = document.getElementById("drawn_list");
              console.log(prize_result);
              drawn_list.innerHTML = gen_list(prize_result);
            }
          }
          // if (!slave_mode) {
          //   window.happy_lottery_tab.close();
          //   window.happy_lottery_tab = function () {
          //       setStringifiedStorageItem(window.messagesKey, "");
          //       window.addEventListener('storage', window.handleNewMessage);
          //       window.happy_lottery_tab = window.open("about:blank", "happy-lottery",'toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=1,height=1');
          //   };
          //   console.log(newValue);
          //   window.removeEventListener('storage',window.handleNewMessage,false);
          // }
      }

      window.happy_lottery_tab = function () {
          setStringifiedStorageItem(window.messagesKey, "");
          window.addEventListener('storage', window.handleNewMessage);
          if (slave_mode) {
            window.happy_lottery_tab = window.open(`${url}?role=slave`, "happy-lottery");
          } else {
            window.happy_lottery_tab = window.open(`about:blank`, "happy-lottery",'toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=yes,width=1,height=1');
          }
      }

      // window.onload = function () {
      //     load_config();
      // };

    function cancel_ready() {
      is_ready = false;
      document.getElementById("shoot").classList.remove("text-danger");
    }

    window.onload = async function (e) {
        // load_config();
        getToken(liffId).then(function(params){
            sendPost(`${url}?role=login`, params).then(function(response){
                if (typeof response.msg !== "undefined") {
                    Swal.fire({
                            title: '系統錯誤',
                            text: "請重新整理",
                            icon: "error",
                            timer: 5000
                    }).then(function(){
                        window.location = `https://liff.line.me/${liffId}`;
                    })
                } else {
                  if (response.result==="NoPermission") {
				  Swal.fire({
					  title: "權限錯誤",
					  text: "您無存取權限，請聯繫管理員開通或登入其他帳號",
                      icon: "error",
					  showDenyButton: true,
					  showCancelButton: true,
					  cancelButtonText: "關閉",
					  confirmButtonText: "重新整理",
					  denyButtonText: `登入其他帳號`
					}).then((result) => {
					  /* Read more about isConfirmed, isDenied below */
					  if (result.isConfirmed) {
						window.location = `https://liff.line.me/${liffId}`;
					  } else if (result.isDenied) {
						liff.logout();
						window.location = `https://liff.line.me/${liffId}`;
					  }
					});
                  } else if (response.result==="OK") {
                    text = response.config;
                    load_config();
					document.getElementById("loading").style.display = "none";
                  }
                  
                    
                }
            });
        }).catch(function (error) {
          Swal.fire({
                  title: '系統錯誤',
                  text: "請重新整理",
                  icon: "error",
                  timer: 5000
          }).then(function(){
              window.location = url;
          })
			});

      document.addEventListener('keydown', function(event){
          console.log(event.button);
          if (event.key==="s") {
            if (document.getElementById("box_no").value!==''){
              is_ready = true;
              document.getElementById("shoot").classList.add("text-danger");
            }
          } else if (event.key==="e") {
            cancel_ready();
          }
      } );

      document.addEventListener('click', function(event){
        if (event.button===0 && is_ready && document.getElementById("box_no").value!=='') {
          cancel_ready();
          lucky_draw();
        }
      });
    };

    </script>
  </body>
</html>
